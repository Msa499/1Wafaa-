<!DOCTYPE html>
<html lang="ar">
<head>
  <!-- ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ ÙƒÙ„ Ø¬Ø²Ø¡ head ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ... -->
</head>
<body>
  <!-- ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ ÙƒÙ„ Ø¬Ø²Ø¡ body ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø­ØªÙ‰ script) ... -->

  <script>
    // ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø­ØªÙ‰ Ø¯Ø§Ù„Ø© showEpisodes) ...

    function showEpisodes(seriesId) {
      const container = document.getElementById("episodesContainer");
      container.innerHTML = "<p style='text-align:center;'>â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø§Øª...</p>";
      
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ù„Ø³Ù„ (Ø¹Ø±Ø¨ÙŠ/Ø£Ø¬Ù†Ø¨ÙŠ)
      let seriesPath = `series/arabe/${seriesId}`;
      
      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ø£ÙˆÙ„Ø§Ù‹
      db.ref(seriesPath).once("value").then(seriesSnapshot => {
        const seriesData = seriesSnapshot.val();
        
        if (!seriesData) {
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ù„Ø³Ù„ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠØŒ Ù†Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠ
          seriesPath = `series/foreign/${seriesId}`;
          return db.ref(seriesPath).once("value");
        }
        return { val: () => seriesData }; // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
      }).then(seriesSnapshot => {
        const seriesData = seriesSnapshot.val();
        
        if (!seriesData) {
          container.innerHTML = "<p style='text-align:center;'>ğŸ™ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„.</p>";
          return;
        }
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­
        return db.ref(`${seriesPath}/episodes`).once("value").then(episodesSnapshot => {
          const episodes = episodesSnapshot.val();
          container.innerHTML = `
            <div style="grid-column:1/-1; text-align:center; margin-bottom:20px;">
              <h2 style="color:#e91e63; margin-bottom:10px;">${seriesData.title}</h2>
              ${seriesData.image ? `<img src="${seriesData.image}" style="max-width:200px; border-radius:8px; margin:0 auto;">` : ''}
            </div>`;
          
          if (!episodes) {
            container.innerHTML += "<p style='text-align:center; grid-column:1/-1;'>ğŸ™ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù„Ù‚Ø§Øª Ù…ØªØ§Ø­Ø©.</p>";
            return;
          }
          
          // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù„Ù‚Ø§Øª
          Object.values(episodes).forEach(ep => {
            if (ep.video && ep.title) {
              container.innerHTML += `
                <div class="episode" onclick="openInPlayer('${ep.video}')">
                  ${ep.image ? `<img src="${ep.image}" alt="${ep.title}">` : '<div style="height:180px;background:#333;display:flex;align-items:center;justify-content:center;">ğŸ¬</div>'}
                  <p>${ep.title}</p>
                </div>`;
            }
          });
          
          document.getElementById("seriesPopup").style.display = "flex";
        });
      }).catch(error => {
        console.error("Error loading episodes:", error);
        container.innerHTML = "<p style='text-align:center;color:red;grid-column:1/-1;'>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø§Øª</p>";
      });
    }

    // ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ...

    function openInPlayer(url) {
      const popup = document.getElementById("videoPopup");
      const video = document.getElementById("videoPlayer");
      const downloadBtn = document.getElementById("downloadBtn");
      
      if (url.includes('.m3u8')) {
        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, function() {
            video.play();
          });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.addEventListener('loadedmetadata', function() {
            video.play();
          });
        }
      } else {
        video.src = url;
      }
      
      downloadBtn.href = url;
      downloadBtn.download = url.split('/').pop() || 'video.mp4';
      popup.style.display = "flex";
    }

    function closeVideo() {
      const video = document.getElementById("videoPlayer");
      video.pause();
      video.src = "";
      document.getElementById("videoPopup").style.display = "none";
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 3000);
    }
  </script>
</body>
</html>
